{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Applications/Projects/school/shiksha-sms/src/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\nimport type { Database } from '@/types/database'\n\nexport function createClient() {\n  return createBrowserClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  )\n}\n\n// Singleton instance for client-side usage\nlet browserClient: ReturnType<typeof createClient> | null = null\n\nexport function getSupabaseClient() {\n  if (!browserClient) {\n    browserClient = createClient()\n  }\n  return browserClient\n}\n"],"names":[],"mappings":";;;;;;AAKI;AALJ;AAAA;;AAGO,SAAS;IACd,OAAO,IAAA,oMAAmB;AAI5B;AAEA,2CAA2C;AAC3C,IAAI,gBAAwD;AAErD,SAAS;IACd,IAAI,CAAC,eAAe;QAClB,gBAAgB;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///Applications/Projects/school/shiksha-sms/src/components/providers/SessionProvider.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useEffect, useState } from 'react'\nimport { User } from '@supabase/supabase-js'\nimport { getSupabaseClient } from '@/lib/supabase/client'\n\ninterface UserProfile {\n  id: string\n  email: string\n  displayName: string\n  role: string\n  schoolId: string | null\n  schoolName: string | null\n}\n\ninterface SessionContextType {\n  user: User | null\n  profile: UserProfile | null\n  loading: boolean\n  signOut: () => Promise<void>\n}\n\nconst SessionContext = createContext<SessionContextType>({\n  user: null,\n  profile: null,\n  loading: true,\n  signOut: async () => {},\n})\n\nexport function useSession() {\n  return useContext(SessionContext)\n}\n\ninterface SessionProviderProps {\n  children: React.ReactNode\n}\n\nexport function SessionProvider({ children }: SessionProviderProps) {\n  const [user, setUser] = useState<User | null>(null)\n  const [profile, setProfile] = useState<UserProfile | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const supabase = getSupabaseClient()\n\n    const fetchProfile = async (authUser: User) => {\n      // Fetch user profile\n      const { data } = await supabase\n        .from('users')\n        .select('id, email, role, school_id')\n        .eq('id', authUser.id)\n        .single()\n\n      const userData = data as { id: string; email: string; role: string; school_id: string | null } | null\n\n      // Get school_id from user record or fallback to auth metadata\n      const schoolId = userData?.school_id || authUser.user_metadata?.school_id || null\n\n      // Fetch school name separately if we have a school_id\n      let schoolName: string | null = null\n      if (schoolId) {\n        const { data: schoolData } = await supabase\n          .from('schools')\n          .select('name')\n          .eq('id', schoolId)\n          .single()\n        schoolName = (schoolData as { name: string } | null)?.name ?? null\n      }\n\n      // Get display name from user metadata, fall back to email prefix\n      const displayName = authUser.user_metadata?.display_name\n        || authUser.user_metadata?.full_name\n        || authUser.user_metadata?.name\n        || authUser.email?.split('@')[0]\n        || 'User'\n\n      if (userData) {\n        setProfile({\n          id: userData.id,\n          email: userData.email,\n          displayName: displayName,\n          role: userData.role,\n          schoolId: schoolId,\n          schoolName: schoolName,\n        })\n      } else {\n        // Fallback to user_metadata if user record doesn't exist yet\n        setProfile({\n          id: authUser.id,\n          email: authUser.email || '',\n          displayName: displayName,\n          role: authUser.user_metadata?.role || 'user',\n          schoolId: schoolId,\n          schoolName: schoolName,\n        })\n      }\n    }\n\n    // Get initial session\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      const authUser = session?.user ?? null\n      setUser(authUser)\n      if (authUser) {\n        fetchProfile(authUser)\n      }\n      setLoading(false)\n    })\n\n    // Listen for auth changes\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      const authUser = session?.user ?? null\n      setUser(authUser)\n      if (authUser) {\n        fetchProfile(authUser)\n      } else {\n        setProfile(null)\n      }\n      setLoading(false)\n    })\n\n    return () => subscription.unsubscribe()\n  }, [])\n\n  const signOut = async () => {\n    const supabase = getSupabaseClient()\n    await supabase.auth.signOut()\n    window.location.href = '/login'\n  }\n\n  return (\n    <SessionContext.Provider value={{ user, profile, loading, signOut }}>\n      {children}\n    </SessionContext.Provider>\n  )\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;;;AAJA;;;AAsBA,MAAM,+BAAiB,IAAA,8KAAa,EAAqB;IACvD,MAAM;IACN,SAAS;IACT,SAAS;IACT,SAAS,WAAa;AACxB;AAEO,SAAS;;IACd,OAAO,IAAA,2KAAU,EAAC;AACpB;GAFgB;AAQT,SAAS,gBAAgB,EAAE,QAAQ,EAAwB;;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAqB;IAC3D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;qCAAC;YACR,MAAM,WAAW,IAAA,wJAAiB;YAElC,MAAM;0DAAe,OAAO;oBAC1B,qBAAqB;oBACrB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SACpB,IAAI,CAAC,SACL,MAAM,CAAC,8BACP,EAAE,CAAC,MAAM,SAAS,EAAE,EACpB,MAAM;oBAET,MAAM,WAAW;oBAEjB,8DAA8D;oBAC9D,MAAM,WAAW,UAAU,aAAa,SAAS,aAAa,EAAE,aAAa;oBAE7E,sDAAsD;oBACtD,IAAI,aAA4B;oBAChC,IAAI,UAAU;wBACZ,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,MAAM,SAChC,IAAI,CAAC,WACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,UACT,MAAM;wBACT,aAAa,AAAC,YAAwC,QAAQ;oBAChE;oBAEA,iEAAiE;oBACjE,MAAM,cAAc,SAAS,aAAa,EAAE,gBACvC,SAAS,aAAa,EAAE,aACxB,SAAS,aAAa,EAAE,QACxB,SAAS,KAAK,EAAE,MAAM,IAAI,CAAC,EAAE,IAC7B;oBAEL,IAAI,UAAU;wBACZ,WAAW;4BACT,IAAI,SAAS,EAAE;4BACf,OAAO,SAAS,KAAK;4BACrB,aAAa;4BACb,MAAM,SAAS,IAAI;4BACnB,UAAU;4BACV,YAAY;wBACd;oBACF,OAAO;wBACL,6DAA6D;wBAC7D,WAAW;4BACT,IAAI,SAAS,EAAE;4BACf,OAAO,SAAS,KAAK,IAAI;4BACzB,aAAa;4BACb,MAAM,SAAS,aAAa,EAAE,QAAQ;4BACtC,UAAU;4BACV,YAAY;wBACd;oBACF;gBACF;;YAEA,sBAAsB;YACtB,SAAS,IAAI,CAAC,UAAU,GAAG,IAAI;6CAAC,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;oBACpD,MAAM,WAAW,SAAS,QAAQ;oBAClC,QAAQ;oBACR,IAAI,UAAU;wBACZ,aAAa;oBACf;oBACA,WAAW;gBACb;;YAEA,0BAA0B;YAC1B,MAAM,EACJ,MAAM,EAAE,YAAY,EAAE,EACvB,GAAG,SAAS,IAAI,CAAC,iBAAiB;6CAAC,CAAC,QAAQ;oBAC3C,MAAM,WAAW,SAAS,QAAQ;oBAClC,QAAQ;oBACR,IAAI,UAAU;wBACZ,aAAa;oBACf,OAAO;wBACL,WAAW;oBACb;oBACA,WAAW;gBACb;;YAEA;6CAAO,IAAM,aAAa,WAAW;;QACvC;oCAAG,EAAE;IAEL,MAAM,UAAU;QACd,MAAM,WAAW,IAAA,wJAAiB;QAClC,MAAM,SAAS,IAAI,CAAC,OAAO;QAC3B,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB;IAEA,qBACE,6LAAC,eAAe,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAS;QAAQ;kBAC/D;;;;;;AAGP;IAnGgB;KAAA"}}]
}