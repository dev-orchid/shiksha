{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Applications/Projects/school/shiksha-sms/src/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\nimport type { Database } from '@/types/database'\n\nexport function createClient() {\n  return createBrowserClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  )\n}\n\n// Singleton instance for client-side usage\nlet browserClient: ReturnType<typeof createClient> | null = null\n\nexport function getSupabaseClient() {\n  if (!browserClient) {\n    browserClient = createClient()\n  }\n  return browserClient\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGO,SAAS;IACd,OAAO,IAAA,iMAAmB;AAI5B;AAEA,2CAA2C;AAC3C,IAAI,gBAAwD;AAErD,SAAS;IACd,IAAI,CAAC,eAAe;QAClB,gBAAgB;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Applications/Projects/school/shiksha-sms/src/components/providers/SessionProvider.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useEffect, useState } from 'react'\nimport { User } from '@supabase/supabase-js'\nimport { getSupabaseClient } from '@/lib/supabase/client'\n\ninterface UserProfile {\n  id: string\n  email: string\n  displayName: string\n  avatarUrl?: string | null\n  role: string\n  schoolId: string | null\n  schoolName: string | null\n  // Plan information\n  planType?: string\n  studentLimit?: number\n  adminUserLimit?: number\n  currentStudents?: number\n  currentAdminUsers?: number\n}\n\ninterface SessionContextType {\n  user: User | null\n  profile: UserProfile | null\n  loading: boolean\n  signOut: () => Promise<void>\n  refreshProfile: () => Promise<void>\n}\n\nconst SessionContext = createContext<SessionContextType>({\n  user: null,\n  profile: null,\n  loading: true,\n  signOut: async () => {},\n  refreshProfile: async () => {},\n})\n\nexport function useSession() {\n  return useContext(SessionContext)\n}\n\ninterface SessionProviderProps {\n  children: React.ReactNode\n}\n\nexport function SessionProvider({ children }: SessionProviderProps) {\n  const [user, setUser] = useState<User | null>(null)\n  const [profile, setProfile] = useState<UserProfile | null>(null)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    const supabase = getSupabaseClient()\n\n    // Fetch profile via API endpoint to bypass RLS issues\n    // (super_admin users have school_id = NULL which may block RLS queries)\n    const fetchProfile = async (authUser: User) => {\n      try {\n        const response = await fetch('/api/auth/profile')\n        if (response.ok) {\n          const data = await response.json()\n          if (data.profile) {\n            setProfile(data.profile)\n            return\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching profile via API:', error)\n      }\n\n      // Fallback to user_metadata if API fails\n      const displayName = authUser.user_metadata?.display_name\n        || authUser.user_metadata?.full_name\n        || authUser.user_metadata?.name\n        || authUser.email?.split('@')[0]\n        || 'User'\n\n      setProfile({\n        id: authUser.id,\n        email: authUser.email || '',\n        displayName: displayName,\n        role: authUser.user_metadata?.role || 'user',\n        schoolId: authUser.user_metadata?.school_id || null,\n        schoolName: null,\n      })\n    }\n\n    // Get initial session\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      const authUser = session?.user ?? null\n      setUser(authUser)\n      if (authUser) {\n        fetchProfile(authUser)\n      }\n      setLoading(false)\n    })\n\n    // Listen for auth changes\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      const authUser = session?.user ?? null\n      setUser(authUser)\n      if (authUser) {\n        fetchProfile(authUser)\n      } else {\n        setProfile(null)\n      }\n      setLoading(false)\n    })\n\n    return () => subscription.unsubscribe()\n  }, [])\n\n  const signOut = async () => {\n    const supabase = getSupabaseClient()\n    await supabase.auth.signOut()\n    window.location.href = '/login'\n  }\n\n  const refreshProfile = async () => {\n    if (!user) return\n\n    try {\n      const response = await fetch('/api/auth/profile')\n      if (response.ok) {\n        const data = await response.json()\n        if (data.profile) {\n          setProfile(data.profile)\n        }\n      }\n    } catch (error) {\n      console.error('Error refreshing profile:', error)\n    }\n  }\n\n  return (\n    <SessionContext.Provider value={{ user, profile, loading, signOut, refreshProfile }}>\n      {children}\n    </SessionContext.Provider>\n  )\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;AAJA;;;;AA8BA,MAAM,+BAAiB,IAAA,sNAAa,EAAqB;IACvD,MAAM;IACN,SAAS;IACT,SAAS;IACT,SAAS,WAAa;IACtB,gBAAgB,WAAa;AAC/B;AAEO,SAAS;IACd,OAAO,IAAA,mNAAU,EAAC;AACpB;AAMO,SAAS,gBAAgB,EAAE,QAAQ,EAAwB;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAqB;IAC3D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,MAAM,WAAW,IAAA,qJAAiB;QAElC,sDAAsD;QACtD,wEAAwE;QACxE,MAAM,eAAe,OAAO;YAC1B,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,IAAI,KAAK,OAAO,EAAE;wBAChB,WAAW,KAAK,OAAO;wBACvB;oBACF;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,mCAAmC;YACnD;YAEA,yCAAyC;YACzC,MAAM,cAAc,SAAS,aAAa,EAAE,gBACvC,SAAS,aAAa,EAAE,aACxB,SAAS,aAAa,EAAE,QACxB,SAAS,KAAK,EAAE,MAAM,IAAI,CAAC,EAAE,IAC7B;YAEL,WAAW;gBACT,IAAI,SAAS,EAAE;gBACf,OAAO,SAAS,KAAK,IAAI;gBACzB,aAAa;gBACb,MAAM,SAAS,aAAa,EAAE,QAAQ;gBACtC,UAAU,SAAS,aAAa,EAAE,aAAa;gBAC/C,YAAY;YACd;QACF;QAEA,sBAAsB;QACtB,SAAS,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;YACpD,MAAM,WAAW,SAAS,QAAQ;YAClC,QAAQ;YACR,IAAI,UAAU;gBACZ,aAAa;YACf;YACA,WAAW;QACb;QAEA,0BAA0B;QAC1B,MAAM,EACJ,MAAM,EAAE,YAAY,EAAE,EACvB,GAAG,SAAS,IAAI,CAAC,iBAAiB,CAAC,CAAC,QAAQ;YAC3C,MAAM,WAAW,SAAS,QAAQ;YAClC,QAAQ;YACR,IAAI,UAAU;gBACZ,aAAa;YACf,OAAO;gBACL,WAAW;YACb;YACA,WAAW;QACb;QAEA,OAAO,IAAM,aAAa,WAAW;IACvC,GAAG,EAAE;IAEL,MAAM,UAAU;QACd,MAAM,WAAW,IAAA,qJAAiB;QAClC,MAAM,SAAS,IAAI,CAAC,OAAO;QAC3B,OAAO,QAAQ,CAAC,IAAI,GAAG;IACzB;IAEA,MAAM,iBAAiB;QACrB,IAAI,CAAC,MAAM;QAEX,IAAI;YACF,MAAM,WAAW,MAAM,MAAM;YAC7B,IAAI,SAAS,EAAE,EAAE;gBACf,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,IAAI,KAAK,OAAO,EAAE;oBAChB,WAAW,KAAK,OAAO;gBACzB;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,6BAA6B;QAC7C;IACF;IAEA,qBACE,8OAAC,eAAe,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;YAAS;YAAS;QAAe;kBAC/E;;;;;;AAGP"}}]
}